<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>GAS-Admin</title>

  <!-- Custom fonts for this template-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
  <!-- Custom styles for this template-->
  <link href="public/css/sb-admin-2.min.css" rel="stylesheet">

</head>
<style>
    .navbar-brand {
        color : white !important;
        font-size: 1.5rem !important;
    }

    
    footer {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        background-color: #1568AC;
        color: white;
        text-align: center;
        line-height: 1; 
    }
  
    body {
        font-family: 'Kanit', sans-serif !important; 

    }


    /* .card {
        margin: 0 auto; 
        float: none; 
        margin-top: 3rem;
         border: none;
    }
    .card-body{

    } */
    div.container4 {
        
       padding-top: 1rem;
       
    }

    #pin .btn-pin {
        border-radius: 50%;
        width: 50px;
        height: 50px;
        text-align: center;
        padding: 5px 0;
        font-size: 22px;
        line-height: 1.428571429;
        font-weight: 500;
        background-color: #1568AC;
        color: white;


    }
    /* .x {
        margin: 0 auto;
    } */

    .btn-next  {
        background-color: #1568AC;
        color: white;

    }
    #pin2 .btn-pin{
        background-color: white;
        color: white;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        text-align: center;
        padding: 5px 0;
        font-size: 22px;
        line-height: 1.428571429;
        font-weight: 500;
    }

    .input-pass input {
        width: 35px;
        border-radius: 4px;

    }

    #edit-pin {
        width: 40px;
        padding-top: 5px;
        cursor: pointer;

    }

    #btn-cancle {
        text-decoration: underline !important;
        padding: 5px 0;
        padding-top: 10px;
    }

    .tab-button {
        padding-top: 10%;
    }


</style>

<body id="body">

    <nav class="navbar navbar-expand navbar-light topbar mb-2 static-top shadow" style="background-color:#1568AC;height: 3rem">
        <a class="navbar-brand" href="#">Chill Gas</a>
    </nav>
   

    <div class="tab-button">
        <div class="row text-center">
            <div class="col-md-4 col-sm-12">

            </div>
            <div class="col-md-4 col-sm-12">
                <p>กรุณากรอกรหัสที่ได้รับในแอปพลิเคชัน</p>
                <!-- <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div> -->
            </div>
            <div class="col-md-4 col-sm-12">

            </div>
            
        </div>


        <div class="row mb-3">
            <div class="col-md-4 col-sm-12 "></div>
            <div class="col-md-4 col-sm-12 align-items-center x">
                <div class="row input-pass d-flex justify-content-center">
                    <div class="col-md-2">
                        <input type="password" class="form-control" id="pass1" maxlength="1">
                    </div>
                    <div class="col-md-2">
                        <input type="password" class="form-control" id="pass2" maxlength="1">
                    </div>
                    <div class="col-md-2">
                        <input type="password" class="form-control" id="pass3" maxlength="1">
                    </div>
                    <div class="col-md-2">
                        <input type="password" class="form-control" id="pass4" maxlength="1">
                    </div>
                    <div class="col-md-2">
                        <input type="password" class="form-control" id="pass5" maxlength="1"> 
                    </div>
                    <div class="col-md-2">
                        <input type="password" class="form-control" id="pass6" maxlength="1">
                    </div>
                    
                </div>
            </div>
            <div class="col-md-4 col-sm-12 ">
                <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-1">
                        <img src="public/img/vector.jpg" id="edit-pin" alt="" style="">  
                    </div>
                    
                </div>
            </div>
        </div>




        <div class="row align-items-center">
            <div class="col-md-4 col-sm-12 "></div> 
            <div class="col-md-4 col-sm-12 align-items-center" id="pin">
                <div class="container" > 
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="1" onclick="myFunction(1)" style="align-items: right;">1</button>
                        </div> 
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="2" onclick="myFunction(2)" style="align-items: center;">2</button>
                        </div> 
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="3" onclick="myFunction(3)"  style="align-items: left;">3</button>
                        </div>  
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-12 " id="pin2">
                <!-- <button type="button" class="btn btn-next">ถัดไป   ></button> -->  
            </div> 
        </div>

        <div class="row">
            <div class="col-md-4 col-sm-12 "></div> 
            <div class="col-md-4 col-sm-12" id="pin">
                <div class="align-items-center container x" >                     
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="4" onclick="myFunction(4)">4</button>
                        </div> 
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="5" onclick="myFunction(5)">5</button>
                        </div> 
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="6" onclick="myFunction(6)">6</button>
                        </div>  
                    </div>

                </div>
            </div>
            <div class="col-md-4 col-sm-12 " id="pin2">              
            </div> 
        </div>
        
        <div class="row">
            <div class="col-md-4 col-sm-12 "></div> 

            <div class="col-md-4 col-sm-12" id="pin">
                <div class="align-items-center container x" > 
                    <div class="row mb-2">
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="7" onclick="myFunction(7)">7</button>
                        </div> 
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="8" onclick="myFunction(8)">8</button>
                        </div> 
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="9" onclick="myFunction(9)">9</button>
                        </div>  
                    </div>

                </div>
            </div>
            <div class="col-md-4 col-sm-12 " id="pin2">
            </div> 
        </div>

        <div class="row">
            <div class="col-md-4 col-sm-12 ">
                <!-- <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-1">
                        <button type="button" class="btn btn-danger mt-2">ยกเลิก</button>
                    </div>

                </div> -->
            </div> 
            <div class="col-md-4 col-sm-12" id="pin">
                <div class="container x" >                    
                    <div class="row mb-1">

                        <div class="col-md-4">
                            <!-- <div class="col-md-1">
                                <button type="button" class="btn btn-link text-left" id="btn-cancle">ยกเลิก</button>
                            </div> -->
                            <button type="button" class="btn btn-link" id="btn-cancle">ยกเลิก</button>
                            <!-- <button type="button" class="btn btn-pin" value="0" onclick="myFunction(0)">0</button> -->

                        </div> 
                        <div class="col-md-4">
                            <button type="button" class="btn btn-pin" value="0" onclick="myFunction(0)">0</button>
                        </div> 
                        <div class="col-md-4">                           
                        </div>  
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-12" id="pin2">
                <!-- <button type="button" class="btn btn-danger mt-2" id="btn-cancle">ยกเลิก</button> -->
            </div> 

        </div>

    </div>


    
    



    <!-- Footer -->
    <footer class="text-right text-lg-start">
        <!-- Copyright -->
        <div class="text-right p-3" style="background-color: rgba(0, 0, 0, 0.2)">
          © Powered by Chill Talk
          
        </div>
        <!-- Copyright -->
    </footer>
    <!-- End of Footer -->


  <!-- Bootstrap core JavaScript-->
  <script src="public/vendor/jquery/jquery.min.js"></script>
  <script src="public/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="public/vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="public/js/sb-admin-2.min.js"></script>
  <script src="public/js/sweetalert.min.js"></script>

  <!-- Page level plugins -->
  <script src="public/vendor/chart.js/Chart.min.js"></script>

  <!-- Page level custom scripts -->
  <script src="public/js/demo/chart-area-demo.js"></script>
  <script src="public/js/demo/chart-pie-demo.js"></script>
  
  <script type="text/javascript" src="env.js"></script> 


</body>

</html>
<script>
    let lastInput = 1 ;
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const type = urlParams.get('type');
    //var span = document.getElementsByClassName("close")[0];

    console.log(type)
    $(document).ready( ()=> {


        $('#pass1').focus();
        $('#pass1').prop( "disabled", true );
        $('#pass2').prop( "disabled", true );
        $('#pass3').prop( "disabled", true );
        $('#pass4').prop( "disabled", true );
        $('#pass5').prop( "disabled", true );
        $('#pass6').prop( "disabled", true );
        // $('#pass6').keyup(()=>{
        //     console.log('ccc')

        // })

        $('#edit-pin').click(()=>{
            //lastInput -=1
            if(lastInput > 1 && lastInput <6)
            {
                lastInput -=1
                console.log("del"+lastInput)
                $('#pass'+(lastInput).toString()).val("");            
                $('#pass'+lastInput.toString()).focus();
            } 
            else if($('#pass6').val() == "")
            {
                lastInput -= 1
                console.log("del"+lastInput)
                $('#pass'+(lastInput).toString()).val("");            
                $('#pass'+lastInput.toString()).focus();
            }
            else{
                lastInput = 1
                console.log("del"+lastInput)
                $('#pass'+(lastInput).toString()).val("");            
                $('#pass'+lastInput.toString()).focus();
            }            
        })

        $('#btn-cancle').click(()=>{           
            window.location.href = "index.html"
        })

        
        $("#box1").click( () => {
            if(type == "in")
            {
                window.location.href = "step2_1.html"
            }
            else{
                window.location.href = "step2_1.html"
            }
        });

        $("#box2").click( ()=> {
            window.location.href = "step2_2.html"
        });     
    });

    // span.onclick = function() {
    //     modal.style.display = "none";
    // }
    function clearInput(){
        document.getElementById("pass1").value = "";
        document.getElementById("pass2").value = "";
        document.getElementById("pass3").value = "";
        document.getElementById("pass4").value = "";
        document.getElementById("pass5").value = "";
        document.getElementById("pass6").value = "";
        document.getElementById("pass1").focus();
    }

    function fullLoopCommand() 
    {
        
    }

    function waitAalertError(milliseconds) 
    {
        swal({
            width: 300,
            icon: "error",
            text: "รหัสผ่านผิด !",
            button: "ตกลง",
        });
        const start = Date.now();
        while (Date.now() - start < milliseconds);
    }

    function myFunction(data) 
    {

        if(document.getElementById("pass6").value == "")
        {
            console.log("กด"+lastInput)
            document.getElementById("pass"+lastInput).value = data;
            if(lastInput < 6){
                lastInput +=1
            }       
            document.getElementById("pass"+lastInput).focus();
            console.log(lastInput)
            if(document.getElementById("pass6").value != "")
            {
               
                let pass = document.getElementById("pass1").value + document.getElementById("pass2").value 
                + document.getElementById("pass3").value +  document.getElementById("pass4").value +
                document.getElementById("pass5").value + document.getElementById("pass6").value
                console.log(pass)  

                if(type == "in")
                {
                    if(pass == "111111")
                    {
                                                
                    }
                    else 
                    {
                        console.log("check pwd")  
                        fetch("http://"+IP_ADDRESS.URL_API_MID+"/app/post/order/checkPwdFromMachineForReturn", {
                        method: "POST", 
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(
                            { 
                                password : pass,
                                machine_code : DATA_FIX.MACHINE_CODE                            
                            })
                        }).then((response) => response.json())
                        //Then with the data from the response in JSON...
                        .then( async (data) => {
                            //console.log( data);
                            // data:
                            // check_password: true
                            // order_detail: {
                            //     order_id: 159
                            //     order_number: "20210603814"
                            // }
                            // status: "success"
                            // statusCode: 201
                            console.log(data)
                            if(data.statusCode == 201)
                            {
                                if(data.data.check_password == false)
                                {
                                    swal({
                                        width: 300,
                                        icon: "error",
                                        text: "รหัสผ่านผิด !",
                                        button: "ตกลง",
                                    }).then((value) => {
                                        location.reload();
                                    });
                                }
                                else{
                                    // true
                                    // {
                                    //     "status": "success",
                                    //     "statusCode": 201,
                                    //     "data": {
                                    //         "check_password": true,
                                    //         "order_detail": {
                                    //             "order_id": 65,
                                    //             "machine_id": 1,
                                    //             "order_number": "202105251305",
                                    //             "send_type": "delivery",
                                    //             "quality": null,
                                    //             "statusorder": 3,
                                    //             "statusReceive": null,
                                    //             "qualityReceive": null
                                    //         }
                                    //     }
                                    // }

                                    gasQuality = data.data.order_detail.quality ;
                                    swal({
                                        width: 300,
                                        icon: "success",
                                        text: "รหัสผ่านถูกต้อง ",
                                        //button: "ตกลง",
                                    });

                                   
                                    // send api python
                                    fetch("http://"+IP_ADDRESS.URL_API_MID+"/app/post/machine/command/gas/in", {
                                    method: "POST", 
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({ 
                                            order_id : data.data.order_detail.order_id,
                                            quality : data.data.order_detail.quality,
                                            machine_code : DATA_FIX.MACHINE_CODE                              
                                        })
                                    })
                                    .then((response) => response.json())
                                    .then((data) => {
                                        console.log("send api");
                                        console.log(data)
                                        if(data.statusCode == 201)
                                        {
                                            swal({
                                                width: 300,
                                                icon: "success",
                                                text: "กำลังดำเนินการ",
                                            });
                                        }
                                        else {
                                            swal({
                                                width: 300,
                                                icon: "error",
                                                text: "การส่งข้อมูลไปส่วนกลางผิดพลาด",
                                            });
                                        }
                                        
                                    })
                                    .catch((error) => {
                                        console.log("catch");
                                    });
                                    console.log(1)
                                    await sleep(2000);  
                                    
                                    
                                }
                            }
                            else{
                                swal({
                                    width: 300,
                                    icon: "error",
                                    text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                    button: "ตกลง",
                                });
                                clearInput();
                            }                            
                        })
                        .catch((error) => {
                            clearInput();
                            swal({
                                html:true,
                                width: 300,
                                icon: "error",
                                text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                button: "ตกลง",
                            });
                        }); // end catch                        
                    }

                }
                else // type == "out"
                {
                    if(pass == "111111")
                    {
                                                
                    }
                    else 
                    {
                        console.log("check pwd")  

                        fetch("http://"+IP_ADDRESS.URL_API_MID+"/app/post/order/checkPwdFromMachineForReceive", {
                        method: "POST", 
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            password : pass,
                            machine_code : DATA_FIX.MACHINE_CODE                            
                        })
                        }).then((response) => response.json())
                        .then(async (data) => {
                             console.log( data);
                            if(data.statusCode == 201)
                            {
                                if(data.data.check_password == false)
                                {    
                                    swal({
                                        width: 300,
                                        icon: "error",
                                        text: "รหัสผ่านผิด !",
                                        button: "ตกลง",
                                    }).then((value) => {
                                        location.reload();
                                    });
                                }
                                else
                                {
                                    // true
                                    gasQuality = data.data.order_detail.quality ;
                                    swal({
                                        width: 300,
                                        icon: "success",
                                        text: "รหัสผ่านถูกต้อง มีจำนวน "+ gasQuality + "ถัง",
                                        //button: "ตกลง",
                                    });

                                    // {
                                    //     "status":"success",
                                    //     "statusCode":201,
                                    //     "data":{
                                    //         "check_password":true,
                                    //         "order_detail":
                                    //         {
                                    //             "order_id":1861,
                                    //             "machine_id":1,
                                    //             "order_number":"202110121454",
                                    //             "send_type":"delivery",
                                    //             "quality":1,"statusorder":2,
                                    //             "statusReceive":null,
                                    //             "qualityReceive":null
                                    //         }
                                    //     }
                                    // }
                                    // send api python
                                    function sleep(ms) {
                                        return new Promise(resolve => setTimeout(resolve, ms));
                                    }
                                    
                                    if(data.data.order_detail.send_type == "delivery") // 1/2 loop
                                    {
                                        console.log(data.data.order_detail.quality)
                                        fetch("http://"+IP_ADDRESS.URL_API_MID+"/app/post/machine/command/gas/out", {
                                                method: "POST", 
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({ 
                                                    order_id : data.data.order_detail.order_id,
                                                    quality : data.data.order_detail.quality,
                                                    machine_code : DATA_FIX.MACHINE_CODE                              
                                                })
                                            })
                                            .then((response) => response.json())
                                            .then((data) => {
                                                console.log("send api");
                                                if(data.statusCode == 201)
                                                {
                                                    swal({
                                                        width: 300,
                                                        icon: "success",
                                                        text: "กำลังดำเนินการ",
                                                    });
                                                }
                                                else {
                                                    swal({
                                                        width: 300,
                                                        icon: "error",
                                                        text: "การส่งข้อมูลไปส่วนกลางผิดพลาด",
                                                    });
                                                }
                                                
                                            })
                                            .catch((error) => {
                                                clearInput();
                                                console.log("catch");
                                                swal({
                                                    html:true,
                                                    width: 300,
                                                    icon: "error",
                                                    text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                                    button: "ตกลง",
                                                });
                                            });
                                        // if(data.data.order_detail.quality == 1)
                                        // {
                                        //     fetch("http://"+IP_ADDRESS.URL_API_MID+"/app/post/machine/command/gas/out", {
                                        //         method: "POST", 
                                        //         headers: {
                                        //             'Content-Type': 'application/json',
                                        //         },
                                        //         body: JSON.stringify({ 
                                        //             order_id : data.data.order_detail.order_id,
                                        //             quality : data.data.order_detail.quality,
                                        //             machine_code : DATA_FIX.MACHINE_CODE                              
                                        //         })
                                        //     })
                                        //     .then((response) => response.json())
                                        //     .then((data) => {
                                        //         console.log("send api");
                                        //         if(data.statusCode == 201)
                                        //         {
                                        //             swal({
                                        //                 width: 300,
                                        //                 icon: "success",
                                        //                 text: "กำลังดำเนินการ",
                                        //             });
                                        //         }
                                        //         else {
                                        //             swal({
                                        //                 width: 300,
                                        //                 icon: "error",
                                        //                 text: "การส่งข้อมูลไปส่วนกลางผิดพลาด",
                                        //             });
                                        //         }
                                                
                                        //     })
                                        //     .catch((error) => {
                                        //         clearInput();
                                        //         console.log("catch");
                                        //         swal({
                                        //             html:true,
                                        //             width: 300,
                                        //             icon: "error",
                                        //             text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                        //             button: "ตกลง",
                                        //         });
                                        //     });
                                        // }
                                        // else {

                                            // console.log("<1")
                                            // for (let i = 0; i < gasQuality; i++) {
                                            //     await ("http://"+IP_ADDRESS.URL_API_MID+"/app/post/machine/command/gas/out", {
                                            //         method: "POST", 
                                            //         headers: {
                                            //             'Content-Type': 'application/json',
                                            //         },
                                            //         body: JSON.stringify({ 
                                            //             order_id : data.data.order_detail.order_id,
                                            //             quality : data.data.order_detail.quality,
                                            //             machine_code : DATA_FIX.MACHINE_CODE                              
                                            //         })
                                            //     })
                                            //     .then((response) => response.json())
                                            //     .then((data) => {
                                            //         console.log("send api");
                                            //         if(data.statusCode == 201)
                                            //         {
                                            //             swal({
                                            //                 width: 300,
                                            //                 icon: "success",
                                            //                 text: "กำลังดำเนินการ",
                                            //             });
                                            //         }
                                            //         else {
                                            //             swal({
                                            //                 width: 300,
                                            //                 icon: "error",
                                            //                 text: "การส่งข้อมูลไปส่วนกลางผิดพลาด",
                                            //             });
                                            //         }                                                
                                            //     })
                                            //     .catch((error) => {
                                            //         clearInput();
                                            //         console.log("catch");
                                            //         swal({
                                            //             html:true,
                                            //             width: 300,
                                            //             icon: "error",
                                            //             text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                            //             button: "ตกลง",
                                            //         });
                                            //     });
                                            //     console.log(1)
                                            // }
                                        //}
                                        
                                    }
                                    else //pickup 1 loop
                                    {
                                        fetch("http://"+IP_ADDRESS.URL_API_MID+"/app/post/machine/command/gas/inOut", {
                                            method: "POST", 
                                            headers: {
                                                'Content-Type': 'application/json',
                                            },
                                            body: JSON.stringify({ 
                                                order_id : data.data.order_detail.order_id,
                                                quality : data.data.order_detail.quality,
                                                machine_code : DATA_FIX.MACHINE_CODE                              
                                            })
                                        })
                                        .then((response) => response.json())
                                        .then((data) => {
                                            console.log("send api");
                                            if(data.statusCode == 201)
                                            {
                                                swal({
                                                    width: 300,
                                                    icon: "success",
                                                    text: "กำลังดำเนินการ",
                                                });
                                            }
                                            else {
                                                swal({
                                                    width: 300,
                                                    icon: "error",
                                                    text: "การส่งข้อมูลไปส่วนกลางผิดพลาด",
                                                });
                                            }
                                            
                                        })
                                        .catch((error) => {
                                            clearInput();
                                            console.log("catch");
                                            swal({
                                                html:true,
                                                width: 300,
                                                icon: "error",
                                                text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                                button: "ตกลง",
                                            });
                                        });
                                    }                                    
                                }
                            }
                            else
                            {
                                swal({
                                    width: 300,
                                    icon: "error",
                                    text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                    button: "ตกลง",
                                });
                                clearInput();
                            }                            
                        })
                        //Then with the error genereted...
                        .catch((error) => {
                            clearInput();
                            swal({
                                html:true,
                                width: 300,
                                icon: "error",
                                text: "ไม่สามารถติดต่อฐานข้อมูลได้ กรุณาติดต่อ Admin",
                                button: "ตกลง",
                            });
                        });
                    
                    }


                }            
            
            }
        }
        else if(document.getElementById("pass6").value != ""){
            console.log("disable")
           
        }
      

    }

</script>
